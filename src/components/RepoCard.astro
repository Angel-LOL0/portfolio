---
import { Star, GitFork, Eye, ExternalLink, Github } from "@lucide/astro";
import type { GitHubRepository } from "types/github";

interface Props {
  repo: GitHubRepository;
  showStats?: boolean;
}

const { repo, showStats = true } = Astro.props;
---

<div
  class="repo-card block p-6 rounded-2xl border border-latte-surface0 dark:border-mocha-surface0 shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all duration-300 bg-latte-mantle/70 dark:bg-mocha-mantle/70 backdrop-blur-xl group"
>
  <div class="flex items-start justify-between mb-2">
    <h3
      class="text-xl font-semibold capitalize text-latte-text dark:text-mocha-text group-hover:text-latte-blue dark:group-hover:text-mocha-blue transition cursor-default"
    >
      {repo.name}
    </h3>
  </div>

  <p
    class="text-sm text-latte-subtext0 dark:text-mocha-subtext0 mb-4 line-clamp-2 cursor-default"
  >
    {repo.description || "Sin descripción"}
  </p>

  {
    showStats && (
      <div class="flex gap-4 mb-4 text-sm text-latte-subtext1 dark:text-mocha-subtext1">
        <div class="flex items-center gap-1 hover:text-latte-yellow dark:hover:text-mocha-yellow transition cursor-pointer">
          <Star class="w-4 h-4" />
          <span>{repo.stargazerCount}</span>
        </div>

        {repo.forkCount !== undefined && (
          <div class="flex items-center gap-1 hover:text-latte-teal dark:hover:text-mocha-teal transition cursor-pointer">
            <GitFork class="w-4 h-4" />
            <span>{repo.forkCount}</span>
          </div>
        )}

        {repo.watchers?.totalCount !== undefined && (
          <div class="flex items-center gap-1 hover:text-latte-sapphire dark:hover:text-mocha-sapphire transition cursor-pointer">
            <Eye class="w-4 h-4" />
            <span>{repo.watchers.totalCount}</span>
          </div>
        )}
      </div>
    )
  }

  {
    repo.languages?.nodes?.length > 0 && (
      <div class="flex gap-2 flex-wrap text-xs mb-4 cursor-pointer">
        {repo.languages.nodes.slice(0, 3).map((lang: any) => (
          <span class="px-2 py-1 bg-latte-surface0 dark:bg-mocha-surface0 text-latte-text dark:text-mocha-text rounded-lg hover:bg-latte-surface1 dark:hover:bg-mocha-surface1 transition">
            {lang.name}
          </span>
        ))}
      </div>
    )
  }

  {
    repo.repositoryTopics?.nodes?.length > 0 && (
      <div class="flex gap-2 flex-wrap text-xs mb-4 cursor-pointer">
        {repo.repositoryTopics.nodes.slice(0, 4).map((t: any) => (
          <span class="px-2 py-1 bg-latte-blue/10 text-latte-blue dark:bg-mocha-blue/20 dark:text-mocha-blue rounded-lg hover:bg-latte-blue/20 dark:hover:bg-mocha-blue/30 transition">
            #{t.topic.name}
          </span>
        ))}
      </div>
    )
  }

  <!-- Botones de enlaces -->
  <div
    class="flex gap-3 mt-4 pt-4 border-t border-latte-surface0 dark:border-mocha-surface0"
  >
    <a
      href={repo.url}
      target="_blank"
      rel="noopener noreferrer"
      class="flex items-center gap-2 px-4 py-2 text-sm font-medium text-latte-text dark:text-mocha-text bg-latte-surface0 dark:bg-mocha-surface0 hover:bg-latte-surface1 dark:hover:bg-mocha-surface1 rounded-lg transition-all hover:scale-105"
    >
      <Github class="w-4 h-4" />
      GitHub
    </a>

    {
      repo.homepageUrl && (
        <a
          href={repo.homepageUrl}
          target="_blank"
          rel="noopener noreferrer"
          class="flex items-center gap-2 px-4 py-2 text-sm font-medium text-latte-crust dark:text-mocha-crust bg-latte-mauve dark:bg-mocha-mauve hover:bg-latte-lavender dark:hover:bg-mocha-lavender rounded-lg transition-all hover:scale-105"
        >
          <ExternalLink class="w-4 h-4" />
          Demo
        </a>
      )
    }
  </div>
</div>

<script>
  // Animación de entrada para las tarjetas
  document.addEventListener("DOMContentLoaded", () => {
    const cards = document.querySelectorAll(".repo-card");

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry, index) => {
          if (entry.isIntersecting) {
            setTimeout(() => {
              entry.target.classList.add("animate-fade-in");
            }, index * 100);
            observer.unobserve(entry.target);
          }
        });
      },
      {
        threshold: 0.1,
        rootMargin: "0px 0px -50px 0px",
      }
    );

    cards.forEach((card) => {
      card.classList.add("opacity-0", "translate-y-8");
      observer.observe(card);
    });
  });
</script>

<style>
  .animate-fade-in {
    animation: fadeInUp 0.6s ease-out forwards;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(2rem);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
